/* ============================================================================
   MISSION CONTROL V3 - Layout System

   Mobile-first CSS Grid layout with named areas.
   Uses container queries for component-level responsiveness.
   ============================================================================ */

/* ============================================================================
   BREAKPOINT DOCUMENTATION

   Mobile-first (min-width) breakpoints:

   | Name   | Width   | Target Devices                  |
   |--------|---------|----------------------------------|
   | base   | 0       | Small phones (320px+)           |
   | sm     | 480px   | Large phones                    |
   | md     | 640px   | Small tablets, landscape phones |
   | lg     | 1024px  | Tablets, small laptops          |
   | xl     | 1280px  | Desktops                        |
   | 2xl    | 1440px  | Large screens                   |

   Layout behavior:
   - base: Single column, drawer navigation
   - md:   Two columns possible, collapsed sidebar
   - lg:   Full sidebar, three-column detail view
   ============================================================================ */

/* ============================================================================
   Root Layout Shell
   ============================================================================ */
.app {
  display: grid;
  min-height: 100vh;
  min-height: 100dvh;
  background: var(--bg-primary);

  /* Mobile: Single column, full width */
  grid-template-columns: 1fr;
  grid-template-rows: auto 1fr;
  grid-template-areas:
    "header"
    "main";
}

/* Tablet and up: Sidebar + Main */
@media (min-width: 640px) {
  .app {
    grid-template-columns: var(--sidebar-width-collapsed) 1fr;
    grid-template-areas:
      "sidebar header"
      "sidebar main";
  }

  .app[data-sidebar="expanded"] {
    grid-template-columns: var(--sidebar-width) 1fr;
  }
}

/* Desktop: Full sidebar by default */
@media (min-width: 1024px) {
  .app {
    grid-template-columns: var(--sidebar-width) 1fr;
  }

  .app[data-sidebar="collapsed"] {
    grid-template-columns: var(--sidebar-width-collapsed) 1fr;
  }
}

/* ============================================================================
   Sidebar Area
   ============================================================================ */
.sidebar {
  grid-area: sidebar;
  position: fixed;
  inset: 0;
  z-index: var(--z-drawer);
  display: flex;
  flex-direction: column;
  width: var(--sidebar-width-mobile);
  max-width: var(--sidebar-max-mobile);
  height: 100vh;
  height: 100dvh;
  background: var(--bg-secondary);
  border-right: 1px solid var(--border-subtle);
  transform: translateX(-100%);
  transition: transform var(--transition-normal);

  /* Enable container queries */
  container-type: inline-size;
  container-name: sidebar;
}

/* On tablet/desktop, account for the fixed footer height */
@media (min-width: 640px) {
  .sidebar {
    height: calc(100vh - 44px); /* Subtract footer height */
    height: calc(100dvh - 44px);
  }
}

.sidebar[data-state="open"] {
  transform: translateX(0);
}

/* Tablet: Static collapsed sidebar */
@media (min-width: 640px) {
  .sidebar {
    position: static;
    width: var(--sidebar-width-collapsed);
    max-width: none;
    transform: none;
    transition: width var(--transition-normal);
  }

  .sidebar[data-state="expanded"] {
    width: var(--sidebar-width);
  }
}

/* Desktop: Full width by default */
@media (min-width: 1024px) {
  .sidebar {
    width: var(--sidebar-width) !important; /* Override any legacy constraints */
    min-width: var(--sidebar-width); /* Ensure it doesn't collapse */
  }

  .sidebar[data-state="collapsed"] {
    width: var(--sidebar-width-collapsed) !important;
    min-width: var(--sidebar-width-collapsed);
  }
}

/* ============================================================================
   Drawer Backdrop (Mobile Only)
   ============================================================================ */
.drawer-backdrop {
  position: fixed;
  inset: 0;
  z-index: calc(var(--z-drawer) - 1);
  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(var(--blur-sm));
  opacity: 0;
  visibility: hidden;
  transition:
    opacity var(--transition-normal),
    visibility var(--transition-normal);
}

.drawer-backdrop[data-visible="true"] {
  opacity: 1;
  visibility: visible;
}

@media (min-width: 640px) {
  .drawer-backdrop {
    display: none;
  }
}

/* ============================================================================
   Main Content Area
   ============================================================================ */
.main-content {
  grid-area: main;
  display: flex;
  flex-direction: column;
  min-width: 0; /* Prevent overflow */
  overflow: hidden; /* Don't scroll the main container */
  max-height: calc(100vh - var(--topbar-height)); /* Constrain to viewport minus topbar */

  /* Enable container queries */
  container-type: inline-size;
  container-name: main;
}

/* ============================================================================
   Top Bar / Header
   ============================================================================ */
.topbar {
  grid-area: header;
  position: sticky;
  top: 0;
  z-index: var(--z-sticky);
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: var(--space-md);
  min-height: var(--topbar-height);
  padding: var(--space-sm) var(--space-md);
  background: var(--bg-primary);
  border-bottom: 1px solid var(--border-subtle);
}

@media (min-width: 640px) {
  .topbar {
    padding: var(--space-sm) var(--space-lg);
  }
}

@media (min-width: 1024px) {
  .topbar {
    padding: var(--space-md) var(--space-xl);
  }
}

/* ============================================================================
   Content Wrapper
   ============================================================================ */
.content-wrapper {
  flex: 1;
  padding: var(--space-md);
  overflow-y: auto;
}

@media (min-width: 640px) {
  .content-wrapper {
    padding: var(--space-lg);
  }
}

@media (min-width: 1024px) {
  .content-wrapper {
    padding: var(--space-xl);
  }
}

/* Max width container */
.content-container {
  width: 100%;
  max-width: var(--content-max-width);
  margin-inline: auto;
}

/* ============================================================================
   View Containers

   IMPORTANT: Views are mutually exclusive. Only ONE should be visible at a time.
   Using high specificity selectors to override legacy styles.
   ============================================================================ */

/* Hide all views by default */
.main-content .view,
.main-content .dashboard-view,
.main-content .detail-view {
  display: none !important;
}

/* Show only the active view */
.main-content .view.active {
  display: block !important;
}

/* ============================================================================
   Dashboard View Layout
   ============================================================================ */
.main-content .dashboard-view.active {
  display: flex !important;
  flex-direction: column;
  gap: var(--space-xl);
  padding: var(--space-md);
  padding-bottom: 60px; /* Space for fixed footer */
  flex: 1; /* Take up remaining space */
  overflow-y: auto; /* Scroll within this area */
  min-height: 0; /* Allow flex shrinking for scroll */
}

@media (min-width: 640px) {
  .main-content .dashboard-view.active {
    padding: var(--space-lg);
  }
}

@media (min-width: 1024px) {
  .main-content .dashboard-view.active {
    padding: var(--space-xl);
  }
}

/* ============================================================================
   Detail View - Three Column Layout
   ============================================================================ */
.main-content .detail-view.active {
  display: flex !important;
  flex-direction: column;
  flex: 1;
  overflow: hidden;
}

.detail-header {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  justify-content: space-between;
  gap: var(--space-md);
  padding: var(--space-md);
  background: var(--bg-secondary);
  border-bottom: 1px solid var(--border-subtle);
}

@media (min-width: 640px) {
  .detail-header {
    padding: var(--space-lg);
  }
}

.detail-body {
  flex: 1;
  display: grid;
  gap: var(--space-md);
  padding: var(--space-md);
  overflow: hidden;

  /* Mobile: Single column, stacked */
  grid-template-columns: 1fr;
  grid-template-areas:
    "center"
    "left"
    "right";
}

@media (min-width: 640px) {
  .detail-body {
    padding: var(--space-lg);
    gap: var(--space-lg);
  }
}

/* Tablet: Two columns */
@media (min-width: 768px) {
  .detail-body {
    grid-template-columns: 260px 1fr;
    grid-template-areas:
      "left center"
      "right center";
  }
}

/* Desktop: Three columns */
@media (min-width: 1024px) {
  .detail-body {
    grid-template-columns: 260px 1fr 280px;
    grid-template-areas:
      "left center right";
    padding: var(--space-xl);
  }
}

.detail-panel-left {
  grid-area: left;
}

.detail-panel-center {
  grid-area: center;
  min-width: 0;
}

.detail-panel-right {
  grid-area: right;
}

/* Panel styling */
.detail-panel {
  display: flex;
  flex-direction: column;
  gap: var(--space-lg);
  overflow-y: auto;
}

/* ============================================================================
   Grid Utilities
   ============================================================================ */

/* Auto-fit grid that wraps items */
.grid-auto-fit {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(min(100%, 250px), 1fr));
  gap: var(--space-lg);
}

/* Auto-fill grid with fixed minimum */
.grid-auto-fill {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: var(--space-md);
}

/* ============================================================================
   Responsive Column Grids
   ============================================================================ */
.grid-cols-1 {
  display: grid;
  grid-template-columns: 1fr;
  gap: var(--space-md);
}

.grid-cols-2 {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: var(--space-md);
}

.grid-cols-3 {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: var(--space-md);
}

.grid-cols-4 {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: var(--space-md);
}

/* Responsive grid: 1 → 2 → 4 columns */
.grid-responsive {
  display: grid;
  grid-template-columns: 1fr;
  gap: var(--space-md);
}

@media (min-width: 480px) {
  .grid-responsive {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (min-width: 1024px) {
  .grid-responsive {
    grid-template-columns: repeat(4, 1fr);
  }
}

/* ============================================================================
   Flex Utilities
   ============================================================================ */
.flex {
  display: flex;
}

.flex-col {
  flex-direction: column;
}

.flex-wrap {
  flex-wrap: wrap;
}

.flex-1 {
  flex: 1;
}

.items-center {
  align-items: center;
}

.items-start {
  align-items: flex-start;
}

.items-end {
  align-items: flex-end;
}

.justify-center {
  justify-content: center;
}

.justify-between {
  justify-content: space-between;
}

.justify-end {
  justify-content: flex-end;
}

.gap-xs { gap: var(--space-xs); }
.gap-sm { gap: var(--space-sm); }
.gap-md { gap: var(--space-md); }
.gap-lg { gap: var(--space-lg); }
.gap-xl { gap: var(--space-xl); }

/* ============================================================================
   Spacing Utilities
   ============================================================================ */
.p-xs { padding: var(--space-xs); }
.p-sm { padding: var(--space-sm); }
.p-md { padding: var(--space-md); }
.p-lg { padding: var(--space-lg); }
.p-xl { padding: var(--space-xl); }

.px-xs { padding-inline: var(--space-xs); }
.px-sm { padding-inline: var(--space-sm); }
.px-md { padding-inline: var(--space-md); }
.px-lg { padding-inline: var(--space-lg); }
.px-xl { padding-inline: var(--space-xl); }

.py-xs { padding-block: var(--space-xs); }
.py-sm { padding-block: var(--space-sm); }
.py-md { padding-block: var(--space-md); }
.py-lg { padding-block: var(--space-lg); }
.py-xl { padding-block: var(--space-xl); }

.m-auto { margin: auto; }
.mx-auto { margin-inline: auto; }
.my-auto { margin-block: auto; }

/* ============================================================================
   Container Queries
   ============================================================================ */

/* Stats grid - responds to container width */
@container main (width < 400px) {
  .stats-section {
    grid-template-columns: 1fr;
  }
}

@container main (width >= 400px) and (width < 700px) {
  .stats-section {
    grid-template-columns: repeat(2, 1fr);
  }
}

@container main (width >= 700px) and (width < 1000px) {
  .stats-section {
    grid-template-columns: repeat(3, 1fr);
  }
}

@container main (width >= 1000px) and (width < 1400px) {
  .stats-section {
    /* Use fixed 4 columns instead of auto-fit minmax which can overflow */
    grid-template-columns: repeat(4, 1fr);
  }
}

@container main (width >= 1400px) {
  .stats-section {
    grid-template-columns: repeat(6, 1fr);
  }
}

/* Sidebar container queries */
@container sidebar (width < 100px) {
  .sidebar-text {
    display: none;
  }

  .sidebar-icon {
    margin: auto;
  }
}

/* ============================================================================
   Overflow Utilities
   ============================================================================ */
.overflow-hidden {
  overflow: hidden;
}

.overflow-auto {
  overflow: auto;
}

.overflow-x-auto {
  overflow-x: auto;
}

.overflow-y-auto {
  overflow-y: auto;
}

/* Horizontal scroll with hidden scrollbar */
.scroll-x-hidden {
  overflow-x: auto;
  scrollbar-width: none;
  -ms-overflow-style: none;
}

.scroll-x-hidden::-webkit-scrollbar {
  display: none;
}

/* ============================================================================
   Position Utilities
   ============================================================================ */
.relative {
  position: relative;
}

.absolute {
  position: absolute;
}

.fixed {
  position: fixed;
}

.sticky {
  position: sticky;
  top: 0;
}

.inset-0 {
  inset: 0;
}

/* ============================================================================
   Width/Height Utilities
   ============================================================================ */
.w-full {
  width: 100%;
}

.h-full {
  height: 100%;
}

.min-h-screen {
  min-height: 100vh;
  min-height: 100dvh;
}

.max-w-screen {
  max-width: 100vw;
}

