# v0.9.0 Plugin System - Phase 2 Continuation

## Context: Where We Left Off

**Date**: 2026-01-01
**Branch**: `claude/plugin-system-v0.9-68Chc`
**Commits**: 2 commits pushed to remote
**Progress**: Phase 1/6 complete âœ…

### What's Done: Phase 1 - Naming Linter

**Files created**:
```
tools/naming-linter/
â”œâ”€â”€ lint.py                 # Main CLI (147 lines)
â”œâ”€â”€ rules/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ common.py           # Pattern validation (160 lines)
â”‚   â””â”€â”€ work_efforts.py     # WorkEffortValidator (337 lines)
â””â”€â”€ README.md               # Documentation (283 lines)
```

**Functionality**:
- âœ… Validates WE folder names: `WE-YYMMDD-xxxx_description/`
- âœ… Validates index files: `WE-YYMMDD-xxxx_index.md`
- âœ… Validates ticket files: `TKT-YYMMDD-NNN_description.md`
- âœ… Validates YAML frontmatter
- âœ… **Auto-fix mode works** (critical fix implemented)

**Testing**:
- âœ… Tested on WE-260101-5cc6_demo_work_effort
- âœ… Successfully renamed tickets: TKT-5cc6-001 â†’ TKT-260101-001
- âœ… Updated frontmatter IDs correctly
- âœ… Validates clean after fixes

**Git status**:
```bash
git log --oneline -2

2da4be5 fix: Implement ticket renaming in naming linter (critical fix)
38bab16 feat: Add naming linter for work effort validation (Phase 1)
```

**Branch is**: Clean, synced with origin, ready for Phase 2

---

## Your Mission: Phase 2 - Plugin Base Classes

### Goal

Create the abstract plugin architecture that Todoist (Phase 3) and future plugins will implement.

### What to Build

```
plugins/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ base.py              # BasePlugin abstract class
â””â”€â”€ _template/           # Template for new plugins
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ plugin.py        # Example implementation
    â””â”€â”€ README.md        # Plugin developer guide
```

### BasePlugin Class Specification

**File**: `plugins/base.py`

```python
"""
Base plugin architecture for external task integrations
"""

from abc import ABC, abstractmethod
from pathlib import Path
from typing import List, Dict, Optional
from dataclasses import dataclass
from datetime import datetime


@dataclass
class ExternalTask:
    """Represents a task from an external service"""
    id: str
    title: str
    description: Optional[str]
    created: datetime
    due_date: Optional[datetime]
    labels: List[str]
    url: str
    raw_data: Dict  # Original API response


@dataclass
class WorkEffort:
    """Represents a created work effort"""
    we_id: str
    folder_path: Path
    index_path: Path
    tickets_dir: Path
    source_task: ExternalTask


class BasePlugin(ABC):
    """
    Abstract base class for external service integrations

    Subclasses must implement all abstract methods to integrate
    a new task management service (Todoist, GitHub Issues, Jira, etc.)
    """

    def __init__(self, config: Dict):
        """
        Initialize plugin with configuration

        Args:
            config: Plugin-specific configuration (API keys, etc.)
        """
        self.config = config
        self.event_handlers = []

    @property
    @abstractmethod
    def name(self) -> str:
        """Plugin name (e.g., 'todoist', 'github-issues')"""
        pass

    @abstractmethod
    def validate_config(self) -> bool:
        """
        Validate plugin configuration

        Returns:
            True if config is valid

        Raises:
            ValueError: If config is invalid with helpful message
        """
        pass

    @abstractmethod
    def fetch_tasks(self) -> List[ExternalTask]:
        """
        Fetch tasks from external service that need processing

        Returns:
            List of ExternalTask objects
        """
        pass

    @abstractmethod
    def create_work_effort(self, task: ExternalTask) -> WorkEffort:
        """
        Create work effort from external task

        Args:
            task: External task to convert

        Returns:
            WorkEffort object with paths to created files

        Raises:
            ValueError: If work effort creation fails validation
        """
        pass

    @abstractmethod
    def post_feedback(self, task: ExternalTask, work_effort: WorkEffort) -> bool:
        """
        Post feedback to external service (comment with link)

        Args:
            task: Original external task
            work_effort: Created work effort

        Returns:
            True if feedback posted successfully
        """
        pass

    @abstractmethod
    def cleanup(self, task: ExternalTask) -> bool:
        """
        Clean up external task (remove trigger label, mark processed)

        Args:
            task: External task to clean up

        Returns:
            True if cleanup successful
        """
        pass

    # Event system (for dashboard integration)
    def emit_event(self, event_type: str, data: Dict):
        """
        Emit event for dashboard visualization

        Event types:
        - plugin.task.fetched
        - plugin.work_effort.created
        - plugin.feedback.posted
        - plugin.cleanup.completed
        - plugin.error
        """
        event = {
            'plugin': self.name,
            'type': event_type,
            'timestamp': datetime.utcnow().isoformat(),
            'data': data
        }

        for handler in self.event_handlers:
            handler(event)

    def on_event(self, handler):
        """Register event handler for dashboard updates"""
        self.event_handlers.append(handler)
```

### Integration with Naming Linter

**IMPORTANT**: Phase 2 must USE Phase 1's naming linter!

```python
# In base.py or create_work_effort implementation
from tools.naming_linter.rules import validate_we_folder_name

def create_work_effort(self, task: ExternalTask) -> WorkEffort:
    # Generate folder name
    folder_name = self._generate_folder_name(task)

    # Validate BEFORE creating (uses Phase 1!)
    error = validate_we_folder_name(folder_name)
    if error:
        raise ValueError(f"Invalid folder name: {error}")

    # Create WE folder...
```

### Template Plugin

**File**: `plugins/_template/plugin.py`

Create a template showing how to implement BasePlugin:

```python
"""
Template Plugin - Copy this to create new integrations

Steps to create a new plugin:
1. Copy this directory to plugins/{service_name}/
2. Rename plugin.py to match your service
3. Implement all abstract methods
4. Add service-specific API client
5. Test with real API
"""

from plugins.base import BasePlugin, ExternalTask, WorkEffort
from typing import List, Dict


class TemplatePlugin(BasePlugin):
    """
    Template plugin showing required implementation

    Replace with your service name (e.g., GitHubIssuesPlugin, JiraPlugin)
    """

    @property
    def name(self) -> str:
        return "template"

    def validate_config(self) -> bool:
        # Check required config keys
        required = ['api_key', 'service_url']
        for key in required:
            if key not in self.config:
                raise ValueError(f"Missing required config: {key}")
        return True

    def fetch_tasks(self) -> List[ExternalTask]:
        # TODO: Implement API call to fetch tasks
        # Example:
        # response = requests.get(
        #     f"{self.config['service_url']}/tasks",
        #     headers={'Authorization': f"Bearer {self.config['api_key']}"}
        # )
        # return [self._parse_task(t) for t in response.json()]
        raise NotImplementedError("Implement fetch_tasks()")

    def create_work_effort(self, task: ExternalTask) -> WorkEffort:
        # TODO: Implement WE creation logic
        raise NotImplementedError("Implement create_work_effort()")

    def post_feedback(self, task: ExternalTask, work_effort: WorkEffort) -> bool:
        # TODO: Post comment back to service
        raise NotImplementedError("Implement post_feedback()")

    def cleanup(self, task: ExternalTask) -> bool:
        # TODO: Remove trigger label or mark processed
        raise NotImplementedError("Implement cleanup()")
```

---

## Implementation Checklist

### Step 1: Create Base Architecture
- [ ] Create `plugins/` directory
- [ ] Create `plugins/__init__.py`
- [ ] Create `plugins/base.py` with:
  - [ ] `ExternalTask` dataclass
  - [ ] `WorkEffort` dataclass
  - [ ] `BasePlugin` abstract class
  - [ ] Event emission system

### Step 2: Create Template
- [ ] Create `plugins/_template/` directory
- [ ] Create `plugins/_template/plugin.py`
- [ ] Create `plugins/_template/README.md` (plugin developer guide)

### Step 3: Integration
- [ ] Import naming linter validation in base.py
- [ ] Add helper methods for WE creation
- [ ] Add helper for sanitizing titles â†’ folder names

### Step 4: Testing
- [ ] Verify imports work
- [ ] Test that template can be instantiated
- [ ] Verify abstract class prevents direct instantiation of BasePlugin

### Step 5: Documentation
- [ ] Create `plugins/README.md` explaining architecture
- [ ] Document event system
- [ ] Document how to create new plugins

---

## Success Criteria

Phase 2 is complete when:

âœ… `BasePlugin` abstract class exists with all required methods
âœ… `ExternalTask` and `WorkEffort` dataclasses defined
âœ… Event system implemented for dashboard integration
âœ… Template plugin shows clear implementation example
âœ… Naming linter integration works (validates folder names)
âœ… Code is clean, documented, and ready for Phase 3 (Todoist)

---

## Next Steps (Phase 3)

After Phase 2 is complete, you'll build:

**Phase 3: Todoist Plugin** - First concrete implementation
- `plugins/todoist/plugin.py` - TodoistPlugin class
- `plugins/todoist/api.py` - Todoist API v2 client
- Configuration handling
- Tests with mocked API

---

## Starting Fresh Chat

**When you start the new chat**, paste this:

```
Continue v0.9.0 Plugin System Development

I'm continuing work on the v0.9.0 plugin system. Phase 1 (naming linter) is complete.

Please read: V0.9.0_PHASE2_CONTINUATION.md

Current branch: claude/plugin-system-v0.9-68Chc
Task: Build Phase 2 (Plugin Base Classes)

Ready to proceed?
```

---

## Important Notes

- **Branch**: Continue on `claude/plugin-system-v0.9-68Chc` (don't create new branch)
- **Commits**: Make atomic commits as you build Phase 2
- **PR**: Don't create PR #27 yet (wait until all 6 phases done)
- **Testing**: Test imports and basic functionality
- **Style**: Follow existing patterns from Phase 1 (naming linter)

---

## Reference Files

**Already built** (reference these):
- `tools/naming-linter/` - Pattern validation (use in plugins)
- `tools/work-effort-migrator/migrate.py` - ID generation logic (reuse!)
- `TODOIST_INTEGRATION_MVP.md` - Original requirements

**Task description**: The original task message in previous chat has full architecture details.

---

Good luck with Phase 2! ðŸš€
